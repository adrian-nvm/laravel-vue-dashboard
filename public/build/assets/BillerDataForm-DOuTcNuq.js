import{V as H,P as p}from"./papaparse.min-CI_TB4km.js";import{B as L}from"./BillerLineDataTable-h7fo0Kxj.js";import{_,r as D,c as o,o as d,b as e,d as F,w as b,n as S,t as f,F as v,x as g,f as m,v as u,a as C,i as c,u as M}from"./app-DRIhpkHk.js";import{h}from"./notify-Cb1X70kf.js";const U={name:"BillerDataForm",components:{VueGoodTable:H,BillerLineDataTable:L},data(){return{toast:M(),lineForm:{startDt:new Date().toISOString().slice(0,7),billerTrxFreq:0,billerTrxAmt:0,billerUniqueCifQty:0},hanaForm:{startDt:new Date().toISOString().slice(0,7),billerMyhanaTrxFreq:0,billerMyhanaTrxAmt:0,billerMyhanaUniqueCifQty:0},csvFile:null,csvData:[],csvHeaders:[],expectedCsvHeaders:["START_DT (DD/MM/YYYY)","BILL_TRX_FREQ","BILL_TRX_AMT","BILL_UNIQUE_CIF_QTY","BILL_MYHANA_TRX_FREQ","BILL_MYHANA_TRX_AMT","BILL_MYHANA_UNIQUE_CIF_QTY"],isDragging:!1,hanaData:[],hanaTotalRecords:0,hanaIsLoading:!1,hanaServerParams:{page:1,per_page:10,start_dt:"",sort:[]},hanaColumns:[{label:"Start Date",field:"startDt",formatFn:this.formatMonthYear,filterOptions:{enabled:!0,placeholder:"Filter by date..."}},{label:"Transaction Frequency",field:"billerMyhanaTrxFreq",tdClass:"text-right",formatFn:this.formatCurrency},{label:"Transaction Amount",field:"billerMyhanaTrxAmt",tdClass:"text-right",formatFn:this.formatCurrency},{label:"Unique CIF Quantity",field:"billerMyhanaUniqueCifQty",tdClass:"text-right",formatFn:this.formatCurrency}]}},mounted(){this.fetchHanaData()},methods:{formatMonthYear(a){if(!a)return"";const t=new Date(a),i=String(t.getMonth()+1).padStart(2,"0"),l=t.getFullYear();return`${i}/${l}`},formatCurrency(a){return new Intl.NumberFormat("id-ID").format(a)},downloadTemplate(){const a=p.unparse([this.expectedCsvHeaders]),t=new Blob([a],{type:"text/csv;charset=utf-8;"}),i=document.createElement("a");i.href=URL.createObjectURL(t),i.setAttribute("download","biller-template.csv"),document.body.appendChild(i),i.click(),document.body.removeChild(i)},async fetchHanaData(){this.hanaIsLoading=!0;try{const{page:a,per_page:t,start_dt:i,sort:l}=this.hanaServerParams;let s=`/biller/hana-data?page=${a}&per_page=${t}&start_dt=${i}`;l.length>0&&l[0].field&&(s+=`&sort_field=${l[0].field}&sort_type=${l[0].type}`);const n=await c.get(s);this.hanaData=n.data.data,this.hanaTotalRecords=n.data.total}catch(a){h(a,this.toast)}finally{this.hanaIsLoading=!1}},onHanaPageChange(a){this.hanaServerParams.page=a.currentPage,this.fetchHanaData()},onHanaPerPageChange(a){this.hanaServerParams.per_page=a.currentPerPage,this.fetchHanaData()},onHanaFilterChange(a){this.hanaServerParams.start_dt=a.columnFilters.startDt,this.fetchHanaData()},onHanaSortChange(a){this.hanaServerParams.sort=a,this.fetchHanaData()},async submitLineForm(){try{const a={...this.lineForm,startDt:`${this.lineForm.startDt}-01`},t=await c.post("biller/line-data",a);this.$refs.billerLineDataTable.fetchLineData(),this.toast.success(t.data.message)}catch(a){h(a,this.toast)}},fetchLineData(){this.$refs.billerLineDataTable.fetchLineData()},async submitHanaForm(){try{const a={...this.hanaForm,startDt:`${this.hanaForm.startDt}-01`},t=await c.post("biller/hana-data",a);this.fetchHanaData(),this.toast.success(t.data.message)}catch(a){h(a,this.toast)}},triggerFileInput(){this.$refs.fileInput.click()},onDragOver(a){this.isDragging=!0},onDragLeave(a){this.isDragging=!1},onDrop(a){this.isDragging=!1;const t=a.dataTransfer.files;t.length>0&&(this.csvFile=t[0],this.parseCsv())},handleFileUpload(a){const t=a.target.files;t.length>0&&(this.csvFile=t[0],this.parseCsv())},parseCsv(){this.csvFile&&p.parse(this.csvFile,{header:!0,skipEmptyLines:!0,complete:a=>{this.csvData=a.data.map(t=>{const i={};for(const l in t)l.trim()==="START_DT (DD/MM/YYYY)"?i.START_DT=t[l]:i[l]=t[l];return i}),this.csvHeaders=a.meta.fields,this.toast.success("CSV file parsed successfully. Please review the data before uploading.")},error:a=>{this.toast.error("Error parsing CSV file."),h(a,this.toast)}})},clearCsvFile(){this.csvFile=null,this.csvData=[],this.csvHeaders=[],this.$refs.fileInput.value=""},async uploadCsv(){if(this.csvData.length===0){this.toast.error("No data to upload. Please select and parse a CSV file.");return}if(JSON.stringify(this.csvHeaders)!==JSON.stringify(this.expectedCsvHeaders)){this.toast.error("CSV headers do not match the template.");return}try{const a=await c.post("/biller/upload",{data:this.csvData});this.fetchLineData(),this.fetchHanaData(),this.clearCsvFile(),this.toast.success(a.data.message)}catch(a){h(a,this.toast)}},async exportHanaData(){try{const a=await c.get("/biller/hana-data?per_page=-1"),t=p.unparse(a.data.data),i=new Blob([t],{type:"text/csv;charset=utf-8;"}),l=document.createElement("a");l.href=URL.createObjectURL(i),l.setAttribute("download","biller-hana-data.csv"),document.body.appendChild(l),l.click(),document.body.removeChild(l)}catch(a){h(a,this.toast)}}}},I={class:"row"},B={class:"col-lg-12"},q={class:"card shadow mb-4"},A={class:"card-header py-3 d-flex flex-row align-items-center justify-content-between"},k={class:"card-body"},P={key:0},V={key:1},Q={key:0,class:"mt-4"},R={class:"table-responsive"},Y={class:"table table-bordered table-sm"},N={key:0},E={class:"tab-content",id:"billerDataTabsContent"},O={class:"tab-pane fade show active",id:"line",role:"tabpanel","aria-labelledby":"line-tab"},j={class:"row mt-4"},X={class:"col-lg-12"},z={class:"card shadow mb-4"},J={class:"card-body"},G={class:"form-group"},K={class:"form-group"},W={class:"form-group"},Z={class:"form-group"},$={class:"col-lg-12"},tt={class:"tab-pane fade",id:"hana",role:"tabpanel","aria-labelledby":"hana-tab"},et={class:"row mt-4"},at={class:"col-lg-12"},rt={class:"card shadow mb-4"},st={class:"card-body"},nt={class:"form-group"},lt={class:"form-group"},it={class:"form-group"},ot={class:"form-group"},dt={class:"col-lg-12"},mt={class:"card shadow mb-4"},ut={class:"card-header py-3 d-flex flex-row align-items-center justify-content-between"},bt={class:"card-body"};function ht(a,t,i,l,s,n){const T=D("BillerLineDataTable"),x=D("vue-good-table");return d(),o("div",null,[t[36]||(t[36]=e("h1",{class:"h3 mb-4 text-gray-800"},"Biller Data Input",-1)),e("div",I,[e("div",B,[e("div",q,[e("div",A,[t[19]||(t[19]=e("h6",{class:"m-0 font-weight-bold text-primary"},"Import CSV Line Bank & Hana Bank",-1)),e("button",{class:"btn btn-info btn-sm",onClick:t[0]||(t[0]=(...r)=>n.downloadTemplate&&n.downloadTemplate(...r))},"Download Template")]),e("div",k,[e("div",{class:S(["upload-zone",{"drag-over":s.isDragging}]),onDragover:t[3]||(t[3]=b((...r)=>n.onDragOver&&n.onDragOver(...r),["prevent"])),onDragleave:t[4]||(t[4]=b((...r)=>n.onDragLeave&&n.onDragLeave(...r),["prevent"])),onDrop:t[5]||(t[5]=b((...r)=>n.onDrop&&n.onDrop(...r),["prevent"])),onClick:t[6]||(t[6]=(...r)=>n.triggerFileInput&&n.triggerFileInput(...r))},[e("input",{type:"file",ref:"fileInput",class:"d-none",accept:".csv",onChange:t[1]||(t[1]=(...r)=>n.handleFileUpload&&n.handleFileUpload(...r))},null,544),s.csvFile?(d(),o("div",V,[t[21]||(t[21]=e("i",{class:"fas fa-file-csv fa-3x mb-3"},null,-1)),e("p",null,"File selected: "+f(s.csvFile.name),1),e("button",{class:"btn btn-danger btn-sm",onClick:t[2]||(t[2]=b((...r)=>n.clearCsvFile&&n.clearCsvFile(...r),["stop"]))},"Remove")])):(d(),o("div",P,[...t[20]||(t[20]=[e("i",{class:"fas fa-cloud-upload-alt fa-3x mb-3"},null,-1),e("p",null,"Drag & drop a CSV file here, or click to select a file.",-1)])]))],34),s.csvData.length?(d(),o("div",Q,[t[22]||(t[22]=e("h6",null,"CSV Data Preview",-1)),e("div",R,[e("table",Y,[e("thead",null,[e("tr",null,[(d(!0),o(v,null,g(s.csvHeaders,r=>(d(),o("th",{key:r},f(r),1))),128))])]),e("tbody",null,[(d(!0),o(v,null,g(s.csvData.slice(0,5),(r,w)=>(d(),o("tr",{key:w},[(d(!0),o(v,null,g(s.csvHeaders,y=>(d(),o("td",{key:y},f(r[y]),1))),128))]))),128))])]),s.csvData.length>5?(d(),o("p",N,[e("i",null,"...and "+f(s.csvData.length-5)+" more rows.",1)])):F("",!0)]),e("button",{onClick:t[7]||(t[7]=(...r)=>n.uploadCsv&&n.uploadCsv(...r)),class:"btn btn-primary mt-3"},"Confirm and Upload")])):F("",!0)])])])]),t[37]||(t[37]=e("ul",{class:"nav nav-tabs",id:"billerDataTabs",role:"tablist"},[e("li",{class:"nav-item",role:"presentation"},[e("button",{class:"nav-link active",id:"line-tab","data-toggle":"tab","data-target":"#line",type:"button",role:"tab","aria-controls":"line","aria-selected":"true"},"Biller Line")]),e("li",{class:"nav-item",role:"presentation"},[e("button",{class:"nav-link",id:"hana-tab","data-toggle":"tab","data-target":"#hana",type:"button",role:"tab","aria-controls":"hana","aria-selected":"false"},"Biller MyHana")])],-1)),e("div",E,[e("div",O,[e("div",j,[e("div",X,[e("div",z,[t[28]||(t[28]=e("div",{class:"card-header py-3"},[e("h6",{class:"m-0 font-weight-bold text-primary"},"Input Biller Line Data")],-1)),e("div",J,[e("form",{onSubmit:t[12]||(t[12]=b((...r)=>n.submitLineForm&&n.submitLineForm(...r),["prevent"]))},[e("div",G,[t[23]||(t[23]=e("label",{for:"lineStartDt"},"Start Date",-1)),m(e("input",{type:"month",class:"form-control",id:"lineStartDt","onUpdate:modelValue":t[8]||(t[8]=r=>s.lineForm.startDt=r)},null,512),[[u,s.lineForm.startDt]])]),e("div",K,[t[24]||(t[24]=e("label",{for:"billerTrxFreq"},"Biller Transaction Frequency",-1)),m(e("input",{type:"number",class:"form-control",id:"billerTrxFreq","onUpdate:modelValue":t[9]||(t[9]=r=>s.lineForm.billerTrxFreq=r)},null,512),[[u,s.lineForm.billerTrxFreq,void 0,{number:!0}]])]),e("div",W,[t[25]||(t[25]=e("label",{for:"billerTrxAmt"},"Biller Transaction Amount",-1)),m(e("input",{type:"number",class:"form-control",id:"billerTrxAmt","onUpdate:modelValue":t[10]||(t[10]=r=>s.lineForm.billerTrxAmt=r)},null,512),[[u,s.lineForm.billerTrxAmt,void 0,{number:!0}]])]),e("div",Z,[t[26]||(t[26]=e("label",{for:"billerUniqueCifQty"},"Biller Unique CIF Quantity",-1)),m(e("input",{type:"number",class:"form-control",id:"billerUniqueCifQty","onUpdate:modelValue":t[11]||(t[11]=r=>s.lineForm.billerUniqueCifQty=r)},null,512),[[u,s.lineForm.billerUniqueCifQty,void 0,{number:!0}]])]),t[27]||(t[27]=e("button",{type:"submit",class:"btn btn-primary"},"Submit Line Data",-1))],32)])])]),e("div",$,[C(T,{ref:"billerLineDataTable"},null,512)])])]),e("div",tt,[e("div",et,[e("div",at,[e("div",rt,[t[34]||(t[34]=e("div",{class:"card-header py-3"},[e("h6",{class:"m-0 font-weight-bold text-primary"},"Input Biller MyHana Data")],-1)),e("div",st,[e("form",{onSubmit:t[17]||(t[17]=b((...r)=>n.submitHanaForm&&n.submitHanaForm(...r),["prevent"]))},[e("div",nt,[t[29]||(t[29]=e("label",{for:"hanaStartDt"},"Start Date",-1)),m(e("input",{type:"month",class:"form-control",id:"hanaStartDt","onUpdate:modelValue":t[13]||(t[13]=r=>s.hanaForm.startDt=r)},null,512),[[u,s.hanaForm.startDt]])]),e("div",lt,[t[30]||(t[30]=e("label",{for:"billerMyhanaTrxFreq"},"Biller MyHana Transaction Frequency",-1)),m(e("input",{type:"number",class:"form-control",id:"billerMyhanaTrxFreq","onUpdate:modelValue":t[14]||(t[14]=r=>s.hanaForm.billerMyhanaTrxFreq=r)},null,512),[[u,s.hanaForm.billerMyhanaTrxFreq,void 0,{number:!0}]])]),e("div",it,[t[31]||(t[31]=e("label",{for:"billerMyhanaTrxAmt"},"Biller MyHana Transaction Amount",-1)),m(e("input",{type:"number",class:"form-control",id:"billerMyhanaTrxAmt","onUpdate:modelValue":t[15]||(t[15]=r=>s.hanaForm.billerMyhanaTrxAmt=r)},null,512),[[u,s.hanaForm.billerMyhanaTrxAmt,void 0,{number:!0}]])]),e("div",ot,[t[32]||(t[32]=e("label",{for:"billerMyhanaUniqueCifQty"},"Biller MyHana Unique CIF Quantity",-1)),m(e("input",{type:"number",class:"form-control",id:"billerMyhanaUniqueCifQty","onUpdate:modelValue":t[16]||(t[16]=r=>s.hanaForm.billerMyhanaUniqueCifQty=r)},null,512),[[u,s.hanaForm.billerMyhanaUniqueCifQty,void 0,{number:!0}]])]),t[33]||(t[33]=e("button",{type:"submit",class:"btn btn-primary"},"Submit MyHana Data",-1))],32)])])]),e("div",dt,[e("div",mt,[e("div",ut,[t[35]||(t[35]=e("h6",{class:"m-0 font-weight-bold text-primary"},"Biller MyHana Data",-1)),e("button",{class:"btn btn-success btn-sm",onClick:t[18]||(t[18]=(...r)=>n.exportHanaData&&n.exportHanaData(...r))},"Export CSV")]),e("div",bt,[C(x,{mode:"remote","is-loading":s.hanaIsLoading,columns:s.hanaColumns,rows:s.hanaData,"total-rows":s.hanaTotalRecords,"pagination-options":{enabled:!0},onPageChange:n.onHanaPageChange,onPerPageChange:n.onHanaPerPageChange,onColumnFilter:n.onHanaFilterChange,onSortChange:n.onHanaSortChange},null,8,["is-loading","columns","rows","total-rows","onPageChange","onPerPageChange","onColumnFilter","onSortChange"])])])])])])])])}const gt=_(U,[["render",ht],["__scopeId","data-v-728fbab3"]]);export{gt as default};
