import{V as x,P as b}from"./papaparse.min-B6Yrehee.js";import{Q as I}from"./QrisLineDataTable-EVt6zbqr.js";import{_ as Q,r as D,c as l,o as d,b as a,d as F,w as h,n as w,t as f,F as v,x as g,f as m,v as u,a as C,i as p,u as H}from"./app-AniJlIbw.js";import{h as c}from"./notify-Cb1X70kf.js";const _={name:"QrisDataForm",components:{VueGoodTable:x,QrisLineDataTable:I},data(){return{toast:H(),lineForm:{startDt:new Date().toISOString().slice(0,7),qrisTrxFreq:0,qrisTrxAmt:0,qrisUniqueCifQty:0},hanaForm:{startDt:new Date().toISOString().slice(0,7),qrisMyhanaTrxFreq:0,qrisMyhanaTrxAmt:0,qrisMyhanaUniqueCifQty:0},csvFile:null,csvData:[],csvHeaders:[],expectedCsvHeaders:["START_DT (DD/MM/YYYY)","QRIS_TRX_FREQ","QRIS_TRX_AMT","QRIS_UNIQUE_CIF_QTY","QRIS_MYHANA_TRX_FREQ","QRIS_MYHANA_TRX_AMT","QRIS_MYHANA_UNIQUE_CIF_QTY"],isDragging:!1,hanaData:[],hanaTotalRecords:0,hanaIsLoading:!1,hanaServerParams:{page:1,per_page:10,start_dt:"",sort:[]},hanaColumns:[{label:"Start Date",field:"startDt",formatFn:this.formatMonthYear,filterOptions:{enabled:!0,placeholder:"Filter by date..."}},{label:"Transaction Frequency",field:"qrisMyhanaTrxFreq",tdClass:"text-right",formatFn:this.formatCurrency},{label:"Transaction Amount",field:"qrisMyhanaTrxAmt",tdClass:"text-right",formatFn:this.formatCurrency},{label:"Unique CIF Quantity",field:"qrisMyhanaUniqueCifQty",tdClass:"text-right",formatFn:this.formatCurrency}]}},mounted(){this.fetchHanaData()},methods:{formatMonthYear(e){if(!e)return"";const t=new Date(e),i=String(t.getMonth()+1).padStart(2,"0"),o=t.getFullYear();return`${i}/${o}`},formatCurrency(e){return new Intl.NumberFormat("id-ID").format(e)},downloadTemplate(){const e=b.unparse([this.expectedCsvHeaders]),t=new Blob([e],{type:"text/csv;charset=utf-8;"}),i=document.createElement("a");i.href=URL.createObjectURL(t),i.setAttribute("download","qris-template.csv"),document.body.appendChild(i),i.click(),document.body.removeChild(i)},async fetchHanaData(){this.hanaIsLoading=!0;try{const{page:e,per_page:t,start_dt:i,sort:o}=this.hanaServerParams;let r=`/qris/hana-data?page=${e}&per_page=${t}&start_dt=${i}`;o.length>0&&o[0].field&&(r+=`&sort_field=${o[0].field}&sort_type=${o[0].type}`);const n=await p.get(r);this.hanaData=n.data.data,this.hanaTotalRecords=n.data.total}catch(e){c(e,this.toast)}finally{this.hanaIsLoading=!1}},onHanaPageChange(e){this.hanaServerParams.page=e.currentPage,this.fetchHanaData()},onHanaPerPageChange(e){this.hanaServerParams.per_page=e.currentPerPage,this.fetchHanaData()},onHanaFilterChange(e){this.hanaServerParams.start_dt=e.columnFilters.startDt,this.fetchHanaData()},onHanaSortChange(e){this.hanaServerParams.sort=e,this.fetchHanaData()},async submitLineForm(){try{const e={...this.lineForm,startDt:`${this.lineForm.startDt}-01`},t=await p.post("qris/line-data",e);this.$refs.qrisLineDataTable.fetchLineData(),this.toast.success(t.data.message)}catch(e){c(e,this.toast)}},fetchLineData(){this.$refs.qrisLineDataTable.fetchLineData()},async submitHanaForm(){try{const e={...this.hanaForm,startDt:`${this.hanaForm.startDt}-01`},t=await p.post("qris/hana-data",e);this.fetchHanaData(),this.toast.success(t.data.message)}catch(e){c(e,this.toast)}},triggerFileInput(){this.$refs.fileInput.click()},onDragOver(e){this.isDragging=!0},onDragLeave(e){this.isDragging=!1},onDrop(e){this.isDragging=!1;const t=e.dataTransfer.files;t.length>0&&(this.csvFile=t[0],this.parseCsv())},handleFileUpload(e){const t=e.target.files;t.length>0&&(this.csvFile=t[0],this.parseCsv())},parseCsv(){this.csvFile&&b.parse(this.csvFile,{header:!0,skipEmptyLines:!0,complete:e=>{this.csvData=e.data.map(t=>{const i={};for(const o in t)o.trim()==="START_DT (DD/MM/YYYY)"?i.START_DT=t[o]:i[o]=t[o];return i}),this.csvHeaders=e.meta.fields,this.toast.success("CSV file parsed successfully. Please review the data before uploading.")},error:e=>{this.toast.error("Error parsing CSV file."),c(e,this.toast)}})},clearCsvFile(){this.csvFile=null,this.csvData=[],this.csvHeaders=[],this.$refs.fileInput.value=""},async uploadCsv(){if(this.csvData.length===0){this.toast.error("No data to upload. Please select and parse a CSV file.");return}if(JSON.stringify(this.csvHeaders)!==JSON.stringify(this.expectedCsvHeaders)){this.toast.error("CSV headers do not match the template.");return}try{const e=await p.post("/qris/upload",{data:this.csvData});this.fetchLineData(),this.fetchHanaData(),this.clearCsvFile(),this.toast.success(e.data.message)}catch(e){c(e,this.toast)}},async exportHanaData(){try{const e=await p.get("/qris/hana-data?per_page=-1"),t=b.unparse(e.data.data),i=new Blob([t],{type:"text/csv;charset=utf-8;"}),o=document.createElement("a");o.href=URL.createObjectURL(i),o.setAttribute("download","qris-hana-data.csv"),document.body.appendChild(o),o.click(),document.body.removeChild(o)}catch(e){c(e,this.toast)}}}},M={class:"row"},R={class:"col-lg-12"},U={class:"card shadow mb-4"},L={class:"card-header py-3 d-flex flex-row align-items-center justify-content-between"},A={class:"card-body"},k={key:0},P={key:1},V={key:0,class:"mt-4"},Y={class:"table-responsive"},N={class:"table table-bordered table-sm"},E={key:0},O={class:"tab-content",id:"qrisDataTabsContent"},B={class:"tab-pane fade show active",id:"line",role:"tabpanel","aria-labelledby":"line-tab"},j={class:"row mt-4"},X={class:"col-lg-12"},z={class:"card shadow mb-4"},J={class:"card-body"},G={class:"form-group"},K={class:"form-group"},W={class:"form-group"},Z={class:"form-group"},$={class:"col-lg-12"},tt={class:"tab-pane fade",id:"hana",role:"tabpanel","aria-labelledby":"hana-tab"},at={class:"row mt-4"},et={class:"col-lg-12"},st={class:"card shadow mb-4"},rt={class:"card-body"},nt={class:"form-group"},ot={class:"form-group"},it={class:"form-group"},lt={class:"form-group"},dt={class:"col-lg-12"},mt={class:"card shadow mb-4"},ut={class:"card-header py-3 d-flex flex-row align-items-center justify-content-between"},ht={class:"card-body"};function ct(e,t,i,o,r,n){const q=D("QrisLineDataTable"),T=D("vue-good-table");return d(),l("div",null,[t[36]||(t[36]=a("h1",{class:"h3 mb-4 text-gray-800"},"QRIS Data Input",-1)),a("div",M,[a("div",R,[a("div",U,[a("div",L,[t[19]||(t[19]=a("h6",{class:"m-0 font-weight-bold text-primary"},"Import CSV Line Bank & Hana Bank",-1)),a("button",{class:"btn btn-info btn-sm",onClick:t[0]||(t[0]=(...s)=>n.downloadTemplate&&n.downloadTemplate(...s))},"Download Template")]),a("div",A,[a("div",{class:w(["upload-zone",{"drag-over":r.isDragging}]),onDragover:t[3]||(t[3]=h((...s)=>n.onDragOver&&n.onDragOver(...s),["prevent"])),onDragleave:t[4]||(t[4]=h((...s)=>n.onDragLeave&&n.onDragLeave(...s),["prevent"])),onDrop:t[5]||(t[5]=h((...s)=>n.onDrop&&n.onDrop(...s),["prevent"])),onClick:t[6]||(t[6]=(...s)=>n.triggerFileInput&&n.triggerFileInput(...s))},[a("input",{type:"file",ref:"fileInput",class:"d-none",accept:".csv",onChange:t[1]||(t[1]=(...s)=>n.handleFileUpload&&n.handleFileUpload(...s))},null,544),r.csvFile?(d(),l("div",P,[t[21]||(t[21]=a("i",{class:"fas fa-file-csv fa-3x mb-3"},null,-1)),a("p",null,"File selected: "+f(r.csvFile.name),1),a("button",{class:"btn btn-danger btn-sm",onClick:t[2]||(t[2]=h((...s)=>n.clearCsvFile&&n.clearCsvFile(...s),["stop"]))},"Remove")])):(d(),l("div",k,[...t[20]||(t[20]=[a("i",{class:"fas fa-cloud-upload-alt fa-3x mb-3"},null,-1),a("p",null,"Drag & drop a CSV file here, or click to select a file.",-1)])]))],34),r.csvData.length?(d(),l("div",V,[t[22]||(t[22]=a("h6",null,"CSV Data Preview",-1)),a("div",Y,[a("table",N,[a("thead",null,[a("tr",null,[(d(!0),l(v,null,g(r.csvHeaders,s=>(d(),l("th",{key:s},f(s),1))),128))])]),a("tbody",null,[(d(!0),l(v,null,g(r.csvData.slice(0,5),(s,S)=>(d(),l("tr",{key:S},[(d(!0),l(v,null,g(r.csvHeaders,y=>(d(),l("td",{key:y},f(s[y]),1))),128))]))),128))])]),r.csvData.length>5?(d(),l("p",E,[a("i",null,"...and "+f(r.csvData.length-5)+" more rows.",1)])):F("",!0)]),a("button",{onClick:t[7]||(t[7]=(...s)=>n.uploadCsv&&n.uploadCsv(...s)),class:"btn btn-primary mt-3"},"Confirm and Upload")])):F("",!0)])])])]),t[37]||(t[37]=a("ul",{class:"nav nav-tabs",id:"qrisDataTabs",role:"tablist"},[a("li",{class:"nav-item",role:"presentation"},[a("button",{class:"nav-link active",id:"line-tab","data-toggle":"tab","data-target":"#line",type:"button",role:"tab","aria-controls":"line","aria-selected":"true"},"QRIS Line")]),a("li",{class:"nav-item",role:"presentation"},[a("button",{class:"nav-link",id:"hana-tab","data-toggle":"tab","data-target":"#hana",type:"button",role:"tab","aria-controls":"hana","aria-selected":"false"},"QRIS MyHana")])],-1)),a("div",O,[a("div",B,[a("div",j,[a("div",X,[a("div",z,[t[28]||(t[28]=a("div",{class:"card-header py-3"},[a("h6",{class:"m-0 font-weight-bold text-primary"},"Input QRIS Line Data")],-1)),a("div",J,[a("form",{onSubmit:t[12]||(t[12]=h((...s)=>n.submitLineForm&&n.submitLineForm(...s),["prevent"]))},[a("div",G,[t[23]||(t[23]=a("label",{for:"lineStartDt"},"Start Date",-1)),m(a("input",{type:"month",class:"form-control",id:"lineStartDt","onUpdate:modelValue":t[8]||(t[8]=s=>r.lineForm.startDt=s)},null,512),[[u,r.lineForm.startDt]])]),a("div",K,[t[24]||(t[24]=a("label",{for:"qrisTrxFreq"},"QRIS Transaction Frequency",-1)),m(a("input",{type:"number",class:"form-control",id:"qrisTrxFreq","onUpdate:modelValue":t[9]||(t[9]=s=>r.lineForm.qrisTrxFreq=s)},null,512),[[u,r.lineForm.qrisTrxFreq,void 0,{number:!0}]])]),a("div",W,[t[25]||(t[25]=a("label",{for:"qrisTrxAmt"},"QRIS Transaction Amount",-1)),m(a("input",{type:"number",class:"form-control",id:"qrisTrxAmt","onUpdate:modelValue":t[10]||(t[10]=s=>r.lineForm.qrisTrxAmt=s)},null,512),[[u,r.lineForm.qrisTrxAmt,void 0,{number:!0}]])]),a("div",Z,[t[26]||(t[26]=a("label",{for:"qrisUniqueCifQty"},"QRIS Unique CIF Quantity",-1)),m(a("input",{type:"number",class:"form-control",id:"qrisUniqueCifQty","onUpdate:modelValue":t[11]||(t[11]=s=>r.lineForm.qrisUniqueCifQty=s)},null,512),[[u,r.lineForm.qrisUniqueCifQty,void 0,{number:!0}]])]),t[27]||(t[27]=a("button",{type:"submit",class:"btn btn-primary"},"Submit Line Data",-1))],32)])])]),a("div",$,[C(q,{ref:"qrisLineDataTable"},null,512)])])]),a("div",tt,[a("div",at,[a("div",et,[a("div",st,[t[34]||(t[34]=a("div",{class:"card-header py-3"},[a("h6",{class:"m-0 font-weight-bold text-primary"},"Input QRIS MyHana Data")],-1)),a("div",rt,[a("form",{onSubmit:t[17]||(t[17]=h((...s)=>n.submitHanaForm&&n.submitHanaForm(...s),["prevent"]))},[a("div",nt,[t[29]||(t[29]=a("label",{for:"hanaStartDt"},"Start Date",-1)),m(a("input",{type:"month",class:"form-control",id:"hanaStartDt","onUpdate:modelValue":t[13]||(t[13]=s=>r.hanaForm.startDt=s)},null,512),[[u,r.hanaForm.startDt]])]),a("div",ot,[t[30]||(t[30]=a("label",{for:"qrisMyhanaTrxFreq"},"QRIS MyHana Transaction Frequency",-1)),m(a("input",{type:"number",class:"form-control",id:"qrisMyhanaTrxFreq","onUpdate:modelValue":t[14]||(t[14]=s=>r.hanaForm.qrisMyhanaTrxFreq=s)},null,512),[[u,r.hanaForm.qrisMyhanaTrxFreq,void 0,{number:!0}]])]),a("div",it,[t[31]||(t[31]=a("label",{for:"qrisMyhanaTrxAmt"},"QRIS MyHana Transaction Amount",-1)),m(a("input",{type:"number",class:"form-control",id:"qrisMyhanaTrxAmt","onUpdate:modelValue":t[15]||(t[15]=s=>r.hanaForm.qrisMyhanaTrxAmt=s)},null,512),[[u,r.hanaForm.qrisMyhanaTrxAmt,void 0,{number:!0}]])]),a("div",lt,[t[32]||(t[32]=a("label",{for:"qrisMyhanaUniqueCifQty"},"QRIS MyHana Unique CIF Quantity",-1)),m(a("input",{type:"number",class:"form-control",id:"qrisMyhanaUniqueCifQty","onUpdate:modelValue":t[16]||(t[16]=s=>r.hanaForm.qrisMyhanaUniqueCifQty=s)},null,512),[[u,r.hanaForm.qrisMyhanaUniqueCifQty,void 0,{number:!0}]])]),t[33]||(t[33]=a("button",{type:"submit",class:"btn btn-primary"},"Submit MyHana Data",-1))],32)])])]),a("div",dt,[a("div",mt,[a("div",ut,[t[35]||(t[35]=a("h6",{class:"m-0 font-weight-bold text-primary"},"QRIS MyHana Data",-1)),a("button",{class:"btn btn-success btn-sm",onClick:t[18]||(t[18]=(...s)=>n.exportHanaData&&n.exportHanaData(...s))},"Export CSV")]),a("div",ht,[C(T,{mode:"remote","is-loading":r.hanaIsLoading,columns:r.hanaColumns,rows:r.hanaData,"total-rows":r.hanaTotalRecords,"pagination-options":{enabled:!0},onPageChange:n.onHanaPageChange,onPerPageChange:n.onHanaPerPageChange,onColumnFilter:n.onHanaFilterChange,onSortChange:n.onHanaSortChange},null,8,["is-loading","columns","rows","total-rows","onPageChange","onPerPageChange","onColumnFilter","onSortChange"])])])])])])])])}const gt=Q(_,[["render",ct],["__scopeId","data-v-e1b1c076"]]);export{gt as default};
