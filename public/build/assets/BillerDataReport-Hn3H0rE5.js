import{V as g,P as _}from"./papaparse.min-B6Yrehee.js";import{B as b}from"./BillerLineDataTable-CyKzOZ7h.js";import{_ as y,r as m,c as C,o as v,b as e,a as d,w as D,f as c,v as p,i as f,u as P}from"./app-AniJlIbw.js";import{h as u}from"./notify-Cb1X70kf.js";const H={name:"BillerDataReport",components:{VueGoodTable:g,BillerLineDataTable:b},data(){return{hana_start_month:"",hana_end_month:"",toast:P(),hanaData:[],hanaTotalRecords:0,hanaIsLoading:!1,hanaServerParams:{page:1,per_page:10,start_dt:"",sort:[],start_month:"",end_month:""},hanaColumns:[{label:"Start Date",field:"startDt",formatFn:this.formatMonthYear,filterOptions:{enabled:!0,placeholder:"Filter by date..."}},{label:"Transaction Frequency",field:"billerMyhanaTrxFreq",tdClass:"text-right",formatFn:this.formatCurrency},{label:"Transaction Amount",field:"billerMyhanaTrxAmt",tdClass:"text-right",formatFn:this.formatCurrency},{label:"Unique CIF Quantity",field:"billerMyhanaUniqueCifQty",tdClass:"text-right",formatFn:this.formatCurrency}]}},mounted(){this.fetchHanaData()},methods:{formatMonthYear(t){if(!t)return"";const a=new Date(t),l=String(a.getMonth()+1).padStart(2,"0"),n=a.getFullYear();return`${l}/${n}`},formatCurrency(t){return new Intl.NumberFormat("id-ID").format(t)},applyHanaFilters(){this.hanaServerParams.start_month=this.hana_start_month,this.hanaServerParams.end_month=this.hana_end_month,this.fetchHanaData()},async fetchHanaData(){this.hanaIsLoading=!0;try{const{page:t,per_page:a,start_dt:l,sort:n,start_month:r,end_month:o}=this.hanaServerParams;let i=`/biller/hana-data?page=${t}&per_page=${a}&start_dt=${l}&start_month=${r}&end_month=${o}`;n.length>0&&n[0].field&&(i+=`&sort_field=${n[0].field}&sort_type=${n[0].type}`);const h=await f.get(i);this.hanaData=h.data.data,this.hanaTotalRecords=h.data.total}catch(t){u(t,this.toast)}finally{this.hanaIsLoading=!1}},onHanaPageChange(t){this.hanaServerParams.page=t.currentPage,this.fetchHanaData()},onHanaPerPageChange(t){this.hanaServerParams.per_page=t.currentPerPage,this.fetchHanaData()},onHanaFilterChange(t){this.hanaServerParams.start_dt=t.columnFilters.startDt,this.fetchHanaData()},onHanaSortChange(t){this.hanaServerParams.sort=t,this.fetchHanaData()},async exportHanaData(){try{const t=await f.get("/biller/hana-data?per_page=-1"),a=_.unparse(t.data.data),l=new Blob([a],{type:"text/csv;charset=utf-8;"}),n=document.createElement("a");n.href=URL.createObjectURL(l),n.setAttribute("download","biller-hana-data.csv"),document.body.appendChild(n),n.click(),document.body.removeChild(n)}catch(t){u(t,this.toast)}}}},x={class:"row"},F={class:"col-lg-6"},w={class:"col-lg-6"},S={class:"card shadow mb-4"},T={class:"card-header py-3"},B={class:"d-flex flex-row align-items-center justify-content-between"},M={class:"form-group mr-3"},L={class:"form-group mr-3"},R={class:"card-body"};function I(t,a,l,n,r,o){const i=m("BillerLineDataTable"),h=m("vue-good-table");return v(),C("div",null,[a[8]||(a[8]=e("h1",{class:"h3 mb-4 text-gray-800"},"Biller Data Report",-1)),e("div",x,[e("div",F,[d(i)]),e("div",w,[e("div",S,[e("div",T,[e("div",B,[a[4]||(a[4]=e("h6",{class:"m-0 font-weight-bold text-primary"},"Biller MyHana Data",-1)),e("button",{class:"btn btn-success btn-sm",onClick:a[0]||(a[0]=(...s)=>o.exportHanaData&&o.exportHanaData(...s))},"Export CSV")]),e("form",{onSubmit:a[3]||(a[3]=D((...s)=>o.applyHanaFilters&&o.applyHanaFilters(...s),["prevent"])),class:"form-inline mt-3"},[e("div",M,[a[5]||(a[5]=e("label",{for:"hana_start_month",class:"mr-2"},"Start Month",-1)),c(e("input",{type:"month",class:"form-control form-control-sm",id:"hana_start_month","onUpdate:modelValue":a[1]||(a[1]=s=>r.hana_start_month=s)},null,512),[[p,r.hana_start_month]])]),e("div",L,[a[6]||(a[6]=e("label",{for:"hana_end_month",class:"mr-2"},"End Month",-1)),c(e("input",{type:"month",class:"form-control form-control-sm",id:"hana_end_month","onUpdate:modelValue":a[2]||(a[2]=s=>r.hana_end_month=s)},null,512),[[p,r.hana_end_month]])]),a[7]||(a[7]=e("button",{type:"submit",class:"btn btn-primary btn-sm"},"Filter",-1))],32)]),e("div",R,[d(h,{mode:"remote","is-loading":r.hanaIsLoading,columns:r.hanaColumns,rows:r.hanaData,"total-rows":r.hanaTotalRecords,"pagination-options":{enabled:!0},onPageChange:o.onHanaPageChange,onPerPageChange:o.onHanaPerPageChange,onColumnFilter:o.onHanaFilterChange,onSortChange:o.onHanaSortChange},null,8,["is-loading","columns","rows","total-rows","onPageChange","onPerPageChange","onColumnFilter","onSortChange"])])])])])])}const q=y(H,[["render",I]]);export{q as default};
