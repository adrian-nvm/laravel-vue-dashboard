import{V as H,P as f}from"./papaparse.min-B6Yrehee.js";import{D as _}from"./DebitLineDataTable-DtzZeEs9.js";import{_ as S,r as y,c as l,o as d,b as e,d as F,w as b,n as M,t as p,F as v,x as g,f as m,v as u,a as C,i as c,u as U}from"./app-AniJlIbw.js";import{h}from"./notify-Cb1X70kf.js";const I={name:"DebitDataForm",components:{VueGoodTable:H,DebitLineDataTable:_},data(){return{toast:U(),lineForm:{startDt:new Date().toISOString().slice(0,7),debitTrxFreq:0,debitTrxAmt:0,debitUniqueCifQty:0},hanaForm:{startDt:new Date().toISOString().slice(0,7),debitMyhanaTrxFreq:0,debitMyhanaTrxAmt:0,debitMyhanaUniqueCifQty:0},csvFile:null,csvData:[],csvHeaders:[],expectedCsvHeaders:["START_DT (DD/MM/YYYY)","DEBIT_TRX_FREQ","DEBIT_TRX_AMT","DEBIT_UNIQUE_CIF_QTY","DEBIT_MYHANA_TRX_FREQ","DEBIT_MYHANA_TRX_AMT","DEBIT_MYHANA_UNIQUE_CIF_QTY"],isDragging:!1,hanaData:[],hanaTotalRecords:0,hanaIsLoading:!1,hanaServerParams:{page:1,per_page:10,start_dt:"",sort:[]},hanaColumns:[{label:"Start Date",field:"startDt",formatFn:this.formatMonthYear,filterOptions:{enabled:!0,placeholder:"Filter by date..."}},{label:"Transaction Frequency",field:"debitMyhanaTrxFreq",tdClass:"text-right",formatFn:this.formatCurrency},{label:"Transaction Amount",field:"debitMyhanaTrxAmt",tdClass:"text-right",formatFn:this.formatCurrency},{label:"Unique CIF Quantity",field:"debitMyhanaUniqueCifQty",tdClass:"text-right",formatFn:this.formatCurrency}]}},mounted(){this.fetchHanaData()},methods:{formatMonthYear(a){if(!a)return"";const t=new Date(a),o=String(t.getMonth()+1).padStart(2,"0"),i=t.getFullYear();return`${o}/${i}`},formatCurrency(a){return new Intl.NumberFormat("id-ID").format(a)},downloadTemplate(){const a=f.unparse([this.expectedCsvHeaders]),t=new Blob([a],{type:"text/csv;charset=utf-8;"}),o=document.createElement("a");o.href=URL.createObjectURL(t),o.setAttribute("download","debit-template.csv"),document.body.appendChild(o),o.click(),document.body.removeChild(o)},async fetchHanaData(){this.hanaIsLoading=!0;try{const{page:a,per_page:t,start_dt:o,sort:i}=this.hanaServerParams;let n=`/debit/hana-data?page=${a}&per_page=${t}&start_dt=${o}`;i.length>0&&i[0].field&&(n+=`&sort_field=${i[0].field}&sort_type=${i[0].type}`);const r=await c.get(n);this.hanaData=r.data.data,this.hanaTotalRecords=r.data.total}catch(a){h(a,this.toast)}finally{this.hanaIsLoading=!1}},onHanaPageChange(a){this.hanaServerParams.page=a.currentPage,this.fetchHanaData()},onHanaPerPageChange(a){this.hanaServerParams.per_page=a.currentPerPage,this.fetchHanaData()},onHanaFilterChange(a){this.hanaServerParams.start_dt=a.columnFilters.startDt,this.fetchHanaData()},onHanaSortChange(a){this.hanaServerParams.sort=a,this.fetchHanaData()},async submitLineForm(){try{const a={...this.lineForm,startDt:`${this.lineForm.startDt}-01`},t=await c.post("debit/line-data",a);this.$refs.debitLineDataTable.fetchLineData(),this.toast.success(t.data.message)}catch(a){h(a,this.toast)}},fetchLineData(){this.$refs.debitLineDataTable.fetchLineData()},async submitHanaForm(){try{const a={...this.hanaForm,startDt:`${this.hanaForm.startDt}-01`},t=await c.post("debit/hana-data",a);this.fetchHanaData(),this.toast.success(t.data.message)}catch(a){h(a,this.toast)}},triggerFileInput(){this.$refs.fileInput.click()},onDragOver(a){this.isDragging=!0},onDragLeave(a){this.isDragging=!1},onDrop(a){this.isDragging=!1;const t=a.dataTransfer.files;t.length>0&&(this.csvFile=t[0],this.parseCsv())},handleFileUpload(a){const t=a.target.files;t.length>0&&(this.csvFile=t[0],this.parseCsv())},parseCsv(){this.csvFile&&f.parse(this.csvFile,{header:!0,skipEmptyLines:!0,complete:a=>{this.csvData=a.data.map(t=>{const o={};for(const i in t)i.trim()==="START_DT (DD/MM/YYYY)"?o.START_DT=t[i]:o[i]=t[i];return o}),this.csvHeaders=a.meta.fields,this.toast.success("CSV file parsed successfully. Please review the data before uploading.")},error:a=>{this.toast.error("Error parsing CSV file."),h(a,this.toast)}})},clearCsvFile(){this.csvFile=null,this.csvData=[],this.csvHeaders=[],this.$refs.fileInput.value=""},async uploadCsv(){if(this.csvData.length===0){this.toast.error("No data to upload. Please select and parse a CSV file.");return}if(JSON.stringify(this.csvHeaders)!==JSON.stringify(this.expectedCsvHeaders)){this.toast.error("CSV headers do not match the template.");return}try{const a=await c.post("/debit/upload",{data:this.csvData});this.fetchLineData(),this.fetchHanaData(),this.clearCsvFile(),this.toast.success(a.data.message)}catch(a){h(a,this.toast)}},async exportHanaData(){try{const a=await c.get("/debit/hana-data?per_page=-1"),t=f.unparse(a.data.data),o=new Blob([t],{type:"text/csv;charset=utf-8;"}),i=document.createElement("a");i.href=URL.createObjectURL(o),i.setAttribute("download","debit-hana-data.csv"),document.body.appendChild(i),i.click(),document.body.removeChild(i)}catch(a){h(a,this.toast)}}}},L={class:"row"},q={class:"col-lg-12"},A={class:"card shadow mb-4"},k={class:"card-header py-3 d-flex flex-row align-items-center justify-content-between"},P={class:"card-body"},V={key:0},Q={key:1},R={key:0,class:"mt-4"},E={class:"table-responsive"},Y={class:"table table-bordered table-sm"},B={key:0},N={class:"tab-content",id:"debitDataTabsContent"},O={class:"tab-pane fade show active",id:"line",role:"tabpanel","aria-labelledby":"line-tab"},j={class:"row mt-4"},X={class:"col-lg-12"},z={class:"card shadow mb-4"},J={class:"card-body"},G={class:"form-group"},K={class:"form-group"},W={class:"form-group"},Z={class:"form-group"},$={class:"col-lg-12"},tt={class:"tab-pane fade",id:"hana",role:"tabpanel","aria-labelledby":"hana-tab"},et={class:"row mt-4"},at={class:"col-lg-12"},st={class:"card shadow mb-4"},nt={class:"card-body"},rt={class:"form-group"},it={class:"form-group"},ot={class:"form-group"},lt={class:"form-group"},dt={class:"col-lg-12"},mt={class:"card shadow mb-4"},ut={class:"card-header py-3 d-flex flex-row align-items-center justify-content-between"},bt={class:"card-body"};function ht(a,t,o,i,n,r){const T=y("DebitLineDataTable"),x=y("vue-good-table");return d(),l("div",null,[t[36]||(t[36]=e("h1",{class:"h3 mb-4 text-gray-800"},"Debit Data Input",-1)),e("div",L,[e("div",q,[e("div",A,[e("div",k,[t[19]||(t[19]=e("h6",{class:"m-0 font-weight-bold text-primary"},"Import CSV Line Bank & Hana Bank",-1)),e("button",{class:"btn btn-info btn-sm",onClick:t[0]||(t[0]=(...s)=>r.downloadTemplate&&r.downloadTemplate(...s))},"Download Template")]),e("div",P,[e("div",{class:M(["upload-zone",{"drag-over":n.isDragging}]),onDragover:t[3]||(t[3]=b((...s)=>r.onDragOver&&r.onDragOver(...s),["prevent"])),onDragleave:t[4]||(t[4]=b((...s)=>r.onDragLeave&&r.onDragLeave(...s),["prevent"])),onDrop:t[5]||(t[5]=b((...s)=>r.onDrop&&r.onDrop(...s),["prevent"])),onClick:t[6]||(t[6]=(...s)=>r.triggerFileInput&&r.triggerFileInput(...s))},[e("input",{type:"file",ref:"fileInput",class:"d-none",accept:".csv",onChange:t[1]||(t[1]=(...s)=>r.handleFileUpload&&r.handleFileUpload(...s))},null,544),n.csvFile?(d(),l("div",Q,[t[21]||(t[21]=e("i",{class:"fas fa-file-csv fa-3x mb-3"},null,-1)),e("p",null,"File selected: "+p(n.csvFile.name),1),e("button",{class:"btn btn-danger btn-sm",onClick:t[2]||(t[2]=b((...s)=>r.clearCsvFile&&r.clearCsvFile(...s),["stop"]))},"Remove")])):(d(),l("div",V,[...t[20]||(t[20]=[e("i",{class:"fas fa-cloud-upload-alt fa-3x mb-3"},null,-1),e("p",null,"Drag & drop a CSV file here, or click to select a file.",-1)])]))],34),n.csvData.length?(d(),l("div",R,[t[22]||(t[22]=e("h6",null,"CSV Data Preview",-1)),e("div",E,[e("table",Y,[e("thead",null,[e("tr",null,[(d(!0),l(v,null,g(n.csvHeaders,s=>(d(),l("th",{key:s},p(s),1))),128))])]),e("tbody",null,[(d(!0),l(v,null,g(n.csvData.slice(0,5),(s,w)=>(d(),l("tr",{key:w},[(d(!0),l(v,null,g(n.csvHeaders,D=>(d(),l("td",{key:D},p(s[D]),1))),128))]))),128))])]),n.csvData.length>5?(d(),l("p",B,[e("i",null,"...and "+p(n.csvData.length-5)+" more rows.",1)])):F("",!0)]),e("button",{onClick:t[7]||(t[7]=(...s)=>r.uploadCsv&&r.uploadCsv(...s)),class:"btn btn-primary mt-3"},"Confirm and Upload")])):F("",!0)])])])]),t[37]||(t[37]=e("ul",{class:"nav nav-tabs",id:"debitDataTabs",role:"tablist"},[e("li",{class:"nav-item",role:"presentation"},[e("button",{class:"nav-link active",id:"line-tab","data-toggle":"tab","data-target":"#line",type:"button",role:"tab","aria-controls":"line","aria-selected":"true"},"Debit Line")]),e("li",{class:"nav-item",role:"presentation"},[e("button",{class:"nav-link",id:"hana-tab","data-toggle":"tab","data-target":"#hana",type:"button",role:"tab","aria-controls":"hana","aria-selected":"false"},"Debit MyHana")])],-1)),e("div",N,[e("div",O,[e("div",j,[e("div",X,[e("div",z,[t[28]||(t[28]=e("div",{class:"card-header py-3"},[e("h6",{class:"m-0 font-weight-bold text-primary"},"Input Debit Line Data")],-1)),e("div",J,[e("form",{onSubmit:t[12]||(t[12]=b((...s)=>r.submitLineForm&&r.submitLineForm(...s),["prevent"]))},[e("div",G,[t[23]||(t[23]=e("label",{for:"lineStartDt"},"Start Date",-1)),m(e("input",{type:"month",class:"form-control",id:"lineStartDt","onUpdate:modelValue":t[8]||(t[8]=s=>n.lineForm.startDt=s)},null,512),[[u,n.lineForm.startDt]])]),e("div",K,[t[24]||(t[24]=e("label",{for:"debitTrxFreq"},"Debit Transaction Frequency",-1)),m(e("input",{type:"number",class:"form-control",id:"debitTrxFreq","onUpdate:modelValue":t[9]||(t[9]=s=>n.lineForm.debitTrxFreq=s)},null,512),[[u,n.lineForm.debitTrxFreq,void 0,{number:!0}]])]),e("div",W,[t[25]||(t[25]=e("label",{for:"debitTrxAmt"},"Debit Transaction Amount",-1)),m(e("input",{type:"number",class:"form-control",id:"debitTrxAmt","onUpdate:modelValue":t[10]||(t[10]=s=>n.lineForm.debitTrxAmt=s)},null,512),[[u,n.lineForm.debitTrxAmt,void 0,{number:!0}]])]),e("div",Z,[t[26]||(t[26]=e("label",{for:"debitUniqueCifQty"},"Debit Unique CIF Quantity",-1)),m(e("input",{type:"number",class:"form-control",id:"debitUniqueCifQty","onUpdate:modelValue":t[11]||(t[11]=s=>n.lineForm.debitUniqueCifQty=s)},null,512),[[u,n.lineForm.debitUniqueCifQty,void 0,{number:!0}]])]),t[27]||(t[27]=e("button",{type:"submit",class:"btn btn-primary"},"Submit Line Data",-1))],32)])])]),e("div",$,[C(T,{ref:"debitLineDataTable"},null,512)])])]),e("div",tt,[e("div",et,[e("div",at,[e("div",st,[t[34]||(t[34]=e("div",{class:"card-header py-3"},[e("h6",{class:"m-0 font-weight-bold text-primary"},"Input Debit MyHana Data")],-1)),e("div",nt,[e("form",{onSubmit:t[17]||(t[17]=b((...s)=>r.submitHanaForm&&r.submitHanaForm(...s),["prevent"]))},[e("div",rt,[t[29]||(t[29]=e("label",{for:"hanaStartDt"},"Start Date",-1)),m(e("input",{type:"month",class:"form-control",id:"hanaStartDt","onUpdate:modelValue":t[13]||(t[13]=s=>n.hanaForm.startDt=s)},null,512),[[u,n.hanaForm.startDt]])]),e("div",it,[t[30]||(t[30]=e("label",{for:"debitMyhanaTrxFreq"},"Debit MyHana Transaction Frequency",-1)),m(e("input",{type:"number",class:"form-control",id:"debitMyhanaTrxFreq","onUpdate:modelValue":t[14]||(t[14]=s=>n.hanaForm.debitMyhanaTrxFreq=s)},null,512),[[u,n.hanaForm.debitMyhanaTrxFreq,void 0,{number:!0}]])]),e("div",ot,[t[31]||(t[31]=e("label",{for:"debitMyhanaTrxAmt"},"Debit MyHana Transaction Amount",-1)),m(e("input",{type:"number",class:"form-control",id:"debitMyhanaTrxAmt","onUpdate:modelValue":t[15]||(t[15]=s=>n.hanaForm.debitMyhanaTrxAmt=s)},null,512),[[u,n.hanaForm.debitMyhanaTrxAmt,void 0,{number:!0}]])]),e("div",lt,[t[32]||(t[32]=e("label",{for:"debitMyhanaUniqueCifQty"},"Debit MyHana Unique CIF Quantity",-1)),m(e("input",{type:"number",class:"form-control",id:"debitMyhanaUniqueCifQty","onUpdate:modelValue":t[16]||(t[16]=s=>n.hanaForm.debitMyhanaUniqueCifQty=s)},null,512),[[u,n.hanaForm.debitMyhanaUniqueCifQty,void 0,{number:!0}]])]),t[33]||(t[33]=e("button",{type:"submit",class:"btn btn-primary"},"Submit MyHana Data",-1))],32)])])]),e("div",dt,[e("div",mt,[e("div",ut,[t[35]||(t[35]=e("h6",{class:"m-0 font-weight-bold text-primary"},"Debit MyHana Data",-1)),e("button",{class:"btn btn-success btn-sm",onClick:t[18]||(t[18]=(...s)=>r.exportHanaData&&r.exportHanaData(...s))},"Export CSV")]),e("div",bt,[C(x,{mode:"remote","is-loading":n.hanaIsLoading,columns:n.hanaColumns,rows:n.hanaData,"total-rows":n.hanaTotalRecords,"pagination-options":{enabled:!0},onPageChange:r.onHanaPageChange,onPerPageChange:r.onHanaPerPageChange,onColumnFilter:r.onHanaFilterChange,onSortChange:r.onHanaSortChange},null,8,["is-loading","columns","rows","total-rows","onPageChange","onPerPageChange","onColumnFilter","onSortChange"])])])])])])])])}const gt=S(I,[["render",ht],["__scopeId","data-v-110e599c"]]);export{gt as default};
