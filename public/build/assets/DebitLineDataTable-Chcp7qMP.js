import{V as g,P as _}from"./papaparse.min-CI_TB4km.js";import{_ as b,L as C,i as m,u as y,r as h,c as L,o as c,b as a,w as D,f as p,v as u,p as v,d as P,a as F}from"./app-DRIhpkHk.js";import{h as f}from"./notify-Cb1X70kf.js";const x={name:"DebitLineDataTable",components:{VueGoodTable:g,LoadingIndicator:C},data(){return{line_start_month:"",line_end_month:"",toast:y(),lineData:[],lineTotalRecords:0,lineIsLoading:!1,lineServerParams:{page:1,per_page:10,start_dt:"",sort:[],start_month:"",end_month:""},lineColumns:[{label:"Start Date (MM/YYYY)",field:"startDt",formatFn:this.formatMonthYear,filterOptions:{enabled:!0,placeholder:"Filter by date..."}},{label:"Transaction Frequency",field:"debitTrxFreq",tdClass:"text-right",formatFn:this.formatCurrency},{label:"Transaction Amount",field:"debitTrxAmt",tdClass:"text-right",formatFn:this.formatCurrency},{label:"Unique CIF Quantity",field:"debitUniqueCifQty",tdClass:"text-right",formatFn:this.formatCurrency}]}},mounted(){this.fetchLineData()},methods:{formatMonthYear(e){if(!e)return"";const t=new Date(e),i=String(t.getMonth()+1).padStart(2,"0"),n=t.getFullYear();return`${i}/${n}`},formatCurrency(e){return new Intl.NumberFormat("id-ID").format(e)},applyLineFilters(){this.lineServerParams.start_month=this.line_start_month,this.lineServerParams.end_month=this.line_end_month,this.fetchLineData()},async fetchLineData(){this.lineIsLoading=!0;try{const{page:e,per_page:t,start_dt:i,sort:n,start_month:r,end_month:o}=this.lineServerParams;let l=`/debit/line-data?page=${e}&per_page=${t}&start_dt=${i}&start_month=${r}&end_month=${o}`;n.length>0&&n[0].field&&(l+=`&sort_field=${n[0].field}&sort_type=${n[0].type}`);const d=await m.get(l);this.lineData=d.data.data,this.lineTotalRecords=d.data.total}catch(e){f(e,this.toast)}finally{this.lineIsLoading=!1}},onLinePageChange(e){this.lineServerParams.page=e.currentPage,this.fetchLineData()},onLinePerPageChange(e){this.lineServerParams.per_page=e.currentPerPage,this.fetchLineData()},onLineFilterChange(e){this.lineServerParams.start_dt=e.columnFilters.startDt,this.fetchLineData()},onLineSortChange(e){this.lineServerParams.sort=e,this.fetchLineData()},async exportLineData(){try{const e=await m.get("/debit/line-data?per_page=-1"),t=_.unparse(e.data.data),i=new Blob([t],{type:"text/csv;charset=utf-8;"}),n=document.createElement("a");n.href=URL.createObjectURL(i),n.setAttribute("download","debit-line-data.csv"),document.body.appendChild(n),n.click(),document.body.removeChild(n)}catch(e){f(e,this.toast)}}}},S={class:"card shadow mb-4"},w={class:"card-header py-3"},T={class:"d-flex flex-row align-items-center justify-content-between"},M={class:"form-group mr-3"},I={class:"form-group mr-3"},V={class:"card-body",style:{position:"relative"}};function k(e,t,i,n,r,o){const l=h("loading-indicator"),d=h("vue-good-table");return c(),L("div",S,[a("div",w,[a("div",T,[t[4]||(t[4]=a("h6",{class:"m-0 font-weight-bold text-primary"},"Debit Line Data",-1)),a("button",{class:"btn btn-success btn-sm",onClick:t[0]||(t[0]=(...s)=>o.exportLineData&&o.exportLineData(...s))},"Export CSV")]),a("form",{onSubmit:t[3]||(t[3]=D((...s)=>o.applyLineFilters&&o.applyLineFilters(...s),["prevent"])),class:"form-inline mt-3"},[a("div",M,[t[5]||(t[5]=a("label",{for:"line_start_month",class:"mr-2"},"Start Month",-1)),p(a("input",{type:"month",class:"form-control form-control-sm",id:"line_start_month","onUpdate:modelValue":t[1]||(t[1]=s=>r.line_start_month=s)},null,512),[[u,r.line_start_month]])]),a("div",I,[t[6]||(t[6]=a("label",{for:"line_end_month",class:"mr-2"},"End Month",-1)),p(a("input",{type:"month",class:"form-control form-control-sm",id:"line_end_month","onUpdate:modelValue":t[2]||(t[2]=s=>r.line_end_month=s)},null,512),[[u,r.line_end_month]])]),t[7]||(t[7]=a("button",{type:"submit",class:"btn btn-primary btn-sm"},"Filter",-1))],32)]),a("div",V,[r.lineIsLoading?(c(),v(l,{key:0})):P("",!0),F(d,{mode:"remote",columns:r.lineColumns,rows:r.lineData,"total-rows":r.lineTotalRecords,"pagination-options":{enabled:!0},onPageChange:o.onLinePageChange,onPerPageChange:o.onLinePerPageChange,onColumnFilter:o.onLineFilterChange,onSortChange:o.onLineSortChange},null,8,["columns","rows","total-rows","onPageChange","onPerPageChange","onColumnFilter","onSortChange"])])])}const E=b(x,[["render",k]]);export{E as D};
