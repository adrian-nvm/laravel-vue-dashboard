import{V as f,P as u}from"./papaparse.min-B6Yrehee.js";import{_ as p,i as m,u as g,r as _,c as b,o as C,b as a,w as y,f as d,v as h,a as L}from"./app-AniJlIbw.js";import{h as c}from"./notify-Cb1X70kf.js";const P={name:"QrisLineDataTable",components:{VueGoodTable:f},data(){return{line_start_month:"",line_end_month:"",toast:g(),lineData:[],lineTotalRecords:0,lineIsLoading:!1,lineServerParams:{page:1,per_page:10,start_dt:"",sort:[],start_month:"",end_month:""},lineColumns:[{label:"Start Date (MM/YYYY)",field:"startDt",formatFn:this.formatMonthYear,filterOptions:{enabled:!0,placeholder:"Filter by date..."}},{label:"Transaction Frequency",field:"qrisTrxFreq",tdClass:"text-right",formatFn:this.formatCurrency},{label:"Transaction Amount",field:"qrisTrxAmt",tdClass:"text-right",formatFn:this.formatCurrency},{label:"Unique CIF Quantity",field:"qrisUniqueCifQty",tdClass:"text-right",formatFn:this.formatCurrency}]}},mounted(){this.fetchLineData()},methods:{formatMonthYear(e){if(!e)return"";const t=new Date(e),i=String(t.getMonth()+1).padStart(2,"0"),n=t.getFullYear();return`${i}/${n}`},formatCurrency(e){return new Intl.NumberFormat("id-ID").format(e)},applyLineFilters(){this.lineServerParams.start_month=this.line_start_month,this.lineServerParams.end_month=this.line_end_month,this.fetchLineData()},async fetchLineData(){this.lineIsLoading=!0;try{const{page:e,per_page:t,start_dt:i,sort:n,start_month:r,end_month:o}=this.lineServerParams;let l=`/qris/line-data?page=${e}&per_page=${t}&start_dt=${i}&start_month=${r}&end_month=${o}`;n.length>0&&n[0].field&&(l+=`&sort_field=${n[0].field}&sort_type=${n[0].type}`);const s=await m.get(l);this.lineData=s.data.data,this.lineTotalRecords=s.data.total}catch(e){c(e,this.toast)}finally{this.lineIsLoading=!1}},onLinePageChange(e){this.lineServerParams.page=e.currentPage,this.fetchLineData()},onLinePerPageChange(e){this.lineServerParams.per_page=e.currentPerPage,this.fetchLineData()},onLineFilterChange(e){this.lineServerParams.start_dt=e.columnFilters.startDt,this.fetchLineData()},onLineSortChange(e){this.lineServerParams.sort=e,this.fetchLineData()},async exportLineData(){try{const e=await m.get("/qris/line-data?per_page=-1"),t=u.unparse(e.data.data),i=new Blob([t],{type:"text/csv;charset=utf-8;"}),n=document.createElement("a");n.href=URL.createObjectURL(i),n.setAttribute("download","qris-line-data.csv"),document.body.appendChild(n),n.click(),document.body.removeChild(n)}catch(e){c(e,this.toast)}}}},v={class:"card shadow mb-4"},D={class:"card-header py-3"},F={class:"d-flex flex-row align-items-center justify-content-between"},S={class:"form-group mr-3"},x={class:"form-group mr-3"},w={class:"card-body"};function T(e,t,i,n,r,o){const l=_("vue-good-table");return C(),b("div",v,[a("div",D,[a("div",F,[t[4]||(t[4]=a("h6",{class:"m-0 font-weight-bold text-primary"},"QRIS Line Data",-1)),a("button",{class:"btn btn-success btn-sm",onClick:t[0]||(t[0]=(...s)=>o.exportLineData&&o.exportLineData(...s))},"Export CSV")]),a("form",{onSubmit:t[3]||(t[3]=y((...s)=>o.applyLineFilters&&o.applyLineFilters(...s),["prevent"])),class:"form-inline mt-3"},[a("div",S,[t[5]||(t[5]=a("label",{for:"line_start_month",class:"mr-2"},"Start Month",-1)),d(a("input",{type:"month",class:"form-control form-control-sm",id:"line_start_month","onUpdate:modelValue":t[1]||(t[1]=s=>r.line_start_month=s)},null,512),[[h,r.line_start_month]])]),a("div",x,[t[6]||(t[6]=a("label",{for:"line_end_month",class:"mr-2"},"End Month",-1)),d(a("input",{type:"month",class:"form-control form-control-sm",id:"line_end_month","onUpdate:modelValue":t[2]||(t[2]=s=>r.line_end_month=s)},null,512),[[h,r.line_end_month]])]),t[7]||(t[7]=a("button",{type:"submit",class:"btn btn-primary btn-sm"},"Filter",-1))],32)]),a("div",w,[L(l,{mode:"remote","is-loading":r.lineIsLoading,columns:r.lineColumns,rows:r.lineData,"total-rows":r.lineTotalRecords,"pagination-options":{enabled:!0},onPageChange:o.onLinePageChange,onPerPageChange:o.onLinePerPageChange,onColumnFilter:o.onLineFilterChange,onSortChange:o.onLineSortChange},null,8,["is-loading","columns","rows","total-rows","onPageChange","onPerPageChange","onColumnFilter","onSortChange"])])])}const V=p(P,[["render",T]]);export{V as Q};
