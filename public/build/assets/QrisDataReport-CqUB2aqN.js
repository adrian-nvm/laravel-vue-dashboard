import{V as g,P as _}from"./papaparse.min-B6Yrehee.js";import{Q as b}from"./QrisLineDataTable-EVt6zbqr.js";import{_ as y,r as m,c as C,o as v,b as n,a as d,w as D,f as c,v as p,i as f,u as P}from"./app-AniJlIbw.js";import{h as u}from"./notify-Cb1X70kf.js";const H={name:"QrisDataReport",components:{VueGoodTable:g,QrisLineDataTable:b},data(){return{hana_start_month:"",hana_end_month:"",toast:P(),hanaData:[],hanaTotalRecords:0,hanaIsLoading:!1,hanaServerParams:{page:1,per_page:10,start_dt:"",sort:[],start_month:"",end_month:""},hanaColumns:[{label:"Start Date",field:"startDt",formatFn:this.formatMonthYear,filterOptions:{enabled:!0,placeholder:"Filter by date..."}},{label:"Transaction Frequency",field:"qrisMyhanaTrxFreq",tdClass:"text-right",formatFn:this.formatCurrency},{label:"Transaction Amount",field:"qrisMyhanaTrxAmt",tdClass:"text-right",formatFn:this.formatCurrency},{label:"Unique CIF Quantity",field:"qrisMyhanaUniqueCifQty",tdClass:"text-right",formatFn:this.formatCurrency}]}},mounted(){this.fetchHanaData()},methods:{formatMonthYear(t){if(!t)return"";const a=new Date(t),i=String(a.getMonth()+1).padStart(2,"0"),e=a.getFullYear();return`${i}/${e}`},formatCurrency(t){return new Intl.NumberFormat("id-ID").format(t)},applyHanaFilters(){this.hanaServerParams.start_month=this.hana_start_month,this.hanaServerParams.end_month=this.hana_end_month,this.fetchHanaData()},async fetchHanaData(){this.hanaIsLoading=!0;try{const{page:t,per_page:a,start_dt:i,sort:e,start_month:r,end_month:o}=this.hanaServerParams;let l=`/qris/hana-data?page=${t}&per_page=${a}&start_dt=${i}&start_month=${r}&end_month=${o}`;e.length>0&&e[0].field&&(l+=`&sort_field=${e[0].field}&sort_type=${e[0].type}`);const h=await f.get(l);this.hanaData=h.data.data,this.hanaTotalRecords=h.data.total}catch(t){u(t,this.toast)}finally{this.hanaIsLoading=!1}},onHanaPageChange(t){this.hanaServerParams.page=t.currentPage,this.fetchHanaData()},onHanaPerPageChange(t){this.hanaServerParams.per_page=t.currentPerPage,this.fetchHanaData()},onHanaFilterChange(t){this.hanaServerParams.start_dt=t.columnFilters.startDt,this.fetchHanaData()},onHanaSortChange(t){this.hanaServerParams.sort=t,this.fetchHanaData()},async exportHanaData(){try{const t=await f.get("/qris/hana-data?per_page=-1"),a=_.unparse(t.data.data),i=new Blob([a],{type:"text/csv;charset=utf-8;"}),e=document.createElement("a");e.href=URL.createObjectURL(i),e.setAttribute("download","qris-hana-data.csv"),document.body.appendChild(e),e.click(),document.body.removeChild(e)}catch(t){u(t,this.toast)}}}},S={class:"row"},x={class:"col-lg-6"},F={class:"col-lg-6"},w={class:"card shadow mb-4"},T={class:"card-header py-3"},M={class:"d-flex flex-row align-items-center justify-content-between"},q={class:"form-group mr-3"},Q={class:"form-group mr-3"},R={class:"card-body"};function I(t,a,i,e,r,o){const l=m("QrisLineDataTable"),h=m("vue-good-table");return v(),C("div",null,[a[8]||(a[8]=n("h1",{class:"h3 mb-4 text-gray-800"},"QRIS Data Report",-1)),n("div",S,[n("div",x,[d(l)]),n("div",F,[n("div",w,[n("div",T,[n("div",M,[a[4]||(a[4]=n("h6",{class:"m-0 font-weight-bold text-primary"},"QRIS MyHana Data",-1)),n("button",{class:"btn btn-success btn-sm",onClick:a[0]||(a[0]=(...s)=>o.exportHanaData&&o.exportHanaData(...s))},"Export CSV")]),n("form",{onSubmit:a[3]||(a[3]=D((...s)=>o.applyHanaFilters&&o.applyHanaFilters(...s),["prevent"])),class:"form-inline mt-3"},[n("div",q,[a[5]||(a[5]=n("label",{for:"hana_start_month",class:"mr-2"},"Start Month",-1)),c(n("input",{type:"month",class:"form-control form-control-sm",id:"hana_start_month","onUpdate:modelValue":a[1]||(a[1]=s=>r.hana_start_month=s)},null,512),[[p,r.hana_start_month]])]),n("div",Q,[a[6]||(a[6]=n("label",{for:"hana_end_month",class:"mr-2"},"End Month",-1)),c(n("input",{type:"month",class:"form-control form-control-sm",id:"hana_end_month","onUpdate:modelValue":a[2]||(a[2]=s=>r.hana_end_month=s)},null,512),[[p,r.hana_end_month]])]),a[7]||(a[7]=n("button",{type:"submit",class:"btn btn-primary btn-sm"},"Filter",-1))],32)]),n("div",R,[d(h,{mode:"remote","is-loading":r.hanaIsLoading,columns:r.hanaColumns,rows:r.hanaData,"total-rows":r.hanaTotalRecords,"pagination-options":{enabled:!0},onPageChange:o.onHanaPageChange,onPerPageChange:o.onHanaPerPageChange,onColumnFilter:o.onHanaFilterChange,onSortChange:o.onHanaSortChange},null,8,["is-loading","columns","rows","total-rows","onPageChange","onPerPageChange","onColumnFilter","onSortChange"])])])])])])}const E=y(H,[["render",I]]);export{E as default};
